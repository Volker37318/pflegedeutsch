
<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Teacher Dashboard – PflegeDeutsch</title>
  <meta name="color-scheme" content="light dark">
  <style>
    :root{
      --bg:#0b1020; --card:#121a2e; --text:#e8eefc; --muted:#7082a0; --line:rgba(148,161,255,.14);
      --shadow:0 10px 30px rgba(0,0,0,.35); --ok:#46d27a; --bad:#ff6b6b; --accent:#7aa2ff;
    }
    @media (prefers-color-scheme: light){
      :root{--bg:#f6f8ff;--card:#ffffff;--text:#10152a;--muted:#6a7696;--line:rgba(30,50,110,.12);--shadow:0 10px 30px rgba(18,28,54,.12);--ok:#0f9d58;--bad:#d83b3b;--accent:#2a5cff;}
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; color:var(--text);
      background: radial-gradient(1200px 500px at 20% -10%, rgba(122,162,255,.35), transparent 55%),
                  radial-gradient(900px 500px at 90% 0%, rgba(105,226,211,.28), transparent 55%),
                  var(--bg);
    }
    .wrap{max-width:980px;margin:0 auto;padding:28px 16px 60px}
    header{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:16px}
    h1{margin:0;font-size:20px}
    .sub{font-size:13px;color:var(--muted);margin-top:2px}
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.06), transparent 55%), var(--card);
      border:1px solid var(--line); border-radius:18px; padding:16px; box-shadow:var(--shadow);
    }
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .pill{
      display:inline-flex;align-items:center;gap:8px;padding:8px 10px;border-radius:999px;
      border:1px solid var(--line); background: rgba(255,255,255,.04); font-size:12px; color:var(--text);
    }
    button{
      cursor:pointer; padding:10px 12px; border-radius:12px; border:1px solid var(--line);
      background: rgba(255,255,255,.06); color:var(--text); font-weight:650;
    }
    button.primary{
      background: linear-gradient(135deg, rgba(122,162,255,.95), rgba(105,226,211,.90));
      border:none; color:#081022;
    }
    .hidden{display:none!important}
    .ok{color:var(--ok);font-weight:700}
    .bad{color:var(--bad);font-weight:700}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}
    a{color:var(--accent);text-decoration:none}
    a:hover{text-decoration:underline}
    .grid{display:grid;grid-template-columns: 1fr;gap:16px}
    @media (min-width:900px){.grid{grid-template-columns: 1.1fr .9fr}}
    .hint{color:var(--muted);font-size:13px;line-height:1.45}
    .box{
      border:1px dashed rgba(122,162,255,.35); background: rgba(122,162,255,.07);
      border-radius:14px; padding:14px;
    }
    .list{margin:0;padding-left:18px}
    .list li{margin:6px 0}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Teacher Dashboard</h1>
        <div class="sub">PflegeDeutsch – Dateien empfangen & auswerten</div>
      </div>
      <div class="row">
        <span id="state" class="pill">Status: <span class="bad">Prüfe Login…</span></span>
        <button id="homeBtn">Startseite</button>
        <button id="logoutBtn" class="hidden">Logout</button>
      </div>
    </header>

    <div class="grid">
      <section class="card">
        <h2 style="margin:0 0 10px;font-size:16px;">Eingegangene Dateien</h2>
        <div id="loading" class="hint">Lade…</div>

        <div id="empty" class="box hidden">
          <div class="hint">
            Noch keine Dateien angezeigt. (Als nächstes bauen wir die Upload-Funktion + Liste hier rein.)
          </div>
          <ul class="list hint">
            <li>Teilnehmer laden über eine separate Upload-Seite hoch (nicht hier).</li>
            <li>Dieses Dashboard ist nur für Teacher – geschützt über Teacher-Session.</li>
          </ul>
        </div>

        <div id="content" class="hidden">
          <div class="box">
            <div class="hint">Platzhalter: Hier kommt gleich die Liste der Uploads (Datum, Kurs, Teilnehmer, Datei, Download, Notizen).</div>
          </div>
        </div>
      </section>

      <aside class="card">
        <h2 style="margin:0 0 10px;font-size:16px;">Kurzinfo</h2>
        <div class="hint">
          <div><span class="mono">GET /.netlify/functions/teacher-auth</span> → Session-Check</div>
          <div><span class="mono">GET /.netlify/functions/teacher-auth?logout=1</span> → Logout</div>
        </div>
        <div style="height:12px"></div>
        <div class="box">
          <div class="hint">
            Tipp: Wenn du nicht eingeloggt bist, wirst du automatisch zur Startseite geschickt:
            <span class="mono">/?next=dashboard</span>
          </div>
        </div>
      </aside>
    </div>
  </div>

  <script>
    async function requireTeacher() {
      const stateEl = document.getElementById("state");
      const logoutBtn = document.getElementById("logoutBtn");
      const loading = document.getElementById("loading");
      const empty = document.getElementById("empty");
      const content = document.getElementById("content");

      try {
        const r = await fetch("/.netlify/functions/teacher-auth", {
          method: "GET",
          credentials: "include",
          headers: { "Accept": "application/json" }
        });
        const data = await r.json().catch(() => ({}));

        if (!r.ok) {
          stateEl.innerHTML = 'Status: <span class="bad">Fehler</span>';
          loading.textContent = "Fehler bei der Session-Prüfung: " + (data.error || r.status);
          return;
        }

        if (!data.authenticated) {
          // Nicht eingeloggt -> zurück zum Login (Startseite)
          window.location.replace("/?next=dashboard");
          return;
        }

        // Eingeloggt
        stateEl.innerHTML = 'Status: <span class="ok">Teacher eingeloggt</span>';
        logoutBtn.classList.remove("hidden");
        loading.classList.add("hidden");

        // V1: noch keine Datenquelle -> leere Box zeigen
        empty.classList.remove("hidden");
        content.classList.add("hidden");
      } catch (e) {
        stateEl.innerHTML = 'Status: <span class="bad">Fehler</span>';
        document.getElementById("loading").textContent = "Session-Check Fehler: " + e.message;
      }
    }

    async function logout() {
      try {
        await fetch("/.netlify/functions/teacher-auth?logout=1", {
          method: "GET",
          credentials: "include"
        });
      } catch {}
      window.location.replace("/");
    }

    document.getElementById("logoutBtn").addEventListener("click", logout);
    document.getElementById("homeBtn").addEventListener("click", () => window.location.replace("/"));

    requireTeacher();
  </script>
</body>
</html>
